/**
 * 宏基因组层级分类结构可视化平台 - 样式文件
 * Version: 3.0 - 统一设计系统
 */

/* ========== CSS 变量 - 简洁设计系统 ========== */
:root {
    /* 主色调 - 提升为更明亮温和的蓝灰色 */
    --primary-color: #6b7fa8;
    --primary-dark: #5a6d8f;
    --primary-light: #98a8c4;
    --secondary-color: #6674db;
    --secondary-dark: #5563c9;
    
    /* 状态颜色 - 适度饱和 */
    --success-color: #52c785;
    --success-dark: #42b573;
    --danger-color: #f76b6b;
    --danger-dark: #e85555;
    --info-color: #4fa8eb;
    --info-dark: #3d93d9;
    
    /* 中性色 - 更深的灰度 */
    --text-primary: #1a202c;
    --text-secondary: #4a5568;
    --text-light: #718096;
    --border-color: #e2e8f0;
    --border-light: #edf2f7;
    --bg-white: #ffffff;
    --bg-light: #f7fafc;
    --bg-lighter: #fafbfd;
    --bg-body: #f0f4f8;
    
    /* 渐变 - 更明亮柔和的渐变 */
    --gradient-primary: linear-gradient(135deg, #6b7fa8 0%, #5a6d8f 100%);
    --gradient-primary-hover: linear-gradient(135deg, #5a6d8f 0%, #4d5e7a 100%);
    --gradient-success: linear-gradient(135deg, #52c785 0%, #42b573 100%);
    --gradient-info: linear-gradient(135deg, #4fa8eb 0%, #3d93d9 100%);
    --gradient-danger: linear-gradient(135deg, #f76b6b 0%, #e85555 100%);
    --gradient-bg: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
    --gradient-accent: linear-gradient(135deg, #7687ed 0%, #6674db 100%);

    /* Tree panel specific */
    --tree-panel-bg: #fafbfd;
    --tree-panel-bg-alt: #f5f7fa;
    --tree-panel-border: #dfe4ee;
    --tree-panel-hover-border: #d0d7e6;
    --tree-panel-header-start: #6b7fa8;
    --tree-panel-header-end: #6674db;
    --tree-panel-header-text: #ffffff;
    
    /* 间距系统 */
    --spacing-xs: 4px;
    --spacing-sm: 8px;
    --spacing-md: 12px;
    --spacing-lg: 16px;
    --spacing-xl: 20px;
    --spacing-2xl: 24px;
    --spacing-3xl: 30px;
    
    /* 圆角 - 更小更简洁 */
    --radius-sm: 3px;
    --radius-md: 4px;
    --radius-lg: 6px;
    --radius-xl: 8px;
    --radius-2xl: 10px;
    
    /* 阴影 - 更微妙 */
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.04);
    --shadow-md: 0 2px 4px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 4px 8px rgba(0, 0, 0, 0.08);
    --shadow-xl: 0 8px 16px rgba(0, 0, 0, 0.1);
    --shadow-primary: 0 4px 8px rgba(107, 127, 168, 0.18);
    --shadow-success: 0 4px 8px rgba(82, 199, 133, 0.22);
    
    /* 字体大小 */
    --font-xs: 11px;
    --font-sm: 12px;
    --font-base: 13px;
    --font-md: 14px;
    --font-lg: 15px;
    --font-xl: 16px;
    --font-2xl: 18px;
    --font-3xl: 20px;
    --font-4xl: 24px;
    --font-5xl: 28px;
    
    /* 过渡动画 */
    --transition-fast: all 0.2s ease;
    --transition-base: all 0.3s ease;

    /* Layout defaults */
    --matrix-cell-min-width: clamp(120px, 18vw, 220px);
    --matrix-cell-min-height: clamp(140px, 20vw, 240px);

    /* 新增：面板最小高度和 SVG 默认高度，方便统一调整 */
    --panel-min-height: 420px;       /* 面板最小高度（可按需调整） */
    --panel-svg-height: 520px;       /* SVG 面板默认高度（可按需调整） */
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html, body {
    height: 100%;
}

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: var(--bg-body);
    min-height: 100vh;
    padding: var(--spacing-xl);
    font-size: var(--font-md);
    color: var(--text-primary);
    line-height: 1.6;
}

body.info-modal-open {
    overflow: hidden;
}


.container {
    max-width: 100%;
    margin: 0 auto;
    background: var(--bg-white);
    border-radius: var(--radius-xl);
    box-shadow: var(--shadow-lg);
    overflow: visible; /* allow page scroll when sidebar grows */
    display: flex;
    flex-direction: column;
    min-height: calc(100vh - (var(--spacing-xl) * 2)); /* viewport minus body padding */
}

/* ========== 主体两栏布局（左侧控制栏 + 右侧可视区） ========== */
.app-body {
    display: flex;
    gap: 0; /* move gutter to main-content padding-left so its area captures scroll */
    padding: var(--spacing-xl);
    flex: 1 1 auto;       /* layout grows with content */
    overflow: visible;    /* let page handle scrolling */
}

.sidebar {
    width: 340px;
    min-width: 240px;
    max-width: 460px;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xl);
    border-right: 2px solid var(--border-color); /* clearer visual boundary */
    box-shadow: 1px 0 0 rgba(0,0,0,0.03); /* subtle depth for the divider */
    background: linear-gradient(180deg, #fafbfd 0%, #f8f9fb 100%);
    padding-right: var(--spacing-xl);
    /* 允许内部出现滚动，同时使 resize 生效（resize 对 overflow: visible 无效） */
    overflow-y: auto;
    overflow-x: hidden; /* no horizontal bleed by default */
    position: relative;
    z-index: 2; /* ensure above main if any overlap occurs */
    resize: horizontal; /* allow users to widen the sidebar if needed */
    /* 在侧边栏局部覆盖字体变量，使侧边栏整体字体比全局小一号（每个字号都减 1px） */
    --font-xs: 10px;
    --font-sm: 11px;
    --font-base: 12px;
    --font-md: 13px;
    --font-lg: 14px;
    --font-xl: 15px;
    --font-2xl: 17px;
    --font-3xl: 19px;
    --font-4xl: 23px;
    --font-5xl: 27px;
}

.sidebar-toggle {
    align-self: flex-start;
    margin: var(--spacing-xl) var(--spacing-lg) 0 var(--spacing-lg);
    width: 32px;
    height: 32px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    background: var(--bg-white);
    color: var(--text-secondary);
    box-shadow: var(--shadow-sm);
    cursor: pointer;
    transition: var(--transition-base);
}

.sidebar-toggle:hover {
    background: var(--bg-light);
    color: var(--text-primary);
}

.sidebar-toggle:focus-visible {
    outline: 2px solid var(--secondary-color);
    outline-offset: 2px;
}

.sidebar-toggle .toggle-icon {
    display: inline-block;
    font-size: 16px;
    line-height: 1;
    transition: transform 0.3s ease;
}

.app-body.sidebar-collapsed .sidebar {
    display: none;
}

.app-body.sidebar-collapsed .sidebar-toggle {
    margin-left: 0;
}

.app-body.sidebar-collapsed .sidebar-toggle .toggle-icon {
    transform: rotate(180deg);
}

.app-body.sidebar-collapsed .main-content {
    padding-left: var(--spacing-lg);
}

/* A visible, non-interactive gutter to emphasize the boundary between panels */
/* removed gutter overlay to avoid overlapping the scroll hit area */

.main-content {
    flex: 1 1 auto;
    min-width: 0; /* allow grid to shrink */
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xl);
    padding-right: var(--spacing-xl);
    padding-left: var(--spacing-xl); /* gutter belongs to main-content for better scroll targeting */
    position: sticky;
    top: var(--spacing-xl); /* stick near top of viewport under body padding */
    height: calc(100vh - (var(--spacing-xl) * 2)); /* fill viewport minus body padding */
    z-index: 1;
    overflow-y: auto;     /* scroll only right side content */
}

.header {
    background: var(--gradient-primary);
    color: white;
    padding: var(--spacing-2xl);
    text-align: center;
    border-radius: var(--radius-xl) var(--radius-xl) 0 0;
}

/* Title row: keep paragraph centered but place icon next to H1 in a horizontal row */
.header .title-row {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
}

.header .title-row .title-link {
    display: flex;
    align-items: center;
    gap: 12px;
    color: inherit;
    text-decoration: none;
}

.header .title-row .title-link:hover,
.header .title-row .title-link:focus-visible {
    opacity: 0.95;
    text-decoration: none;
}

.header .title-row .title-link:focus {
    outline: 2px dashed rgba(255,255,255,0.6);
    outline-offset: 4px;
}

.site-icon {
    width: 30px;
    height: 30px;
    display: inline-block;
    object-fit: contain;
}

.header h1 {
    font-size: var(--font-4xl);
    margin-bottom: var(--spacing-sm);
    font-weight: 600;
    letter-spacing: -0.5px;
}

.header p {
    font-size: var(--font-md);
    opacity: 0.95;
    font-weight: 400;
}

.about-section {
    margin: var(--spacing-lg) var(--spacing-lg) var(--spacing-md);
    padding: var(--spacing-md) var(--spacing-xl);
    background: var(--bg-lighter);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-sm);
    text-align: center;
}

.about-content {
    max-width: 960px;
    margin: 0 auto;
}

.about-text {
    margin: 0;
    font-size: var(--font-base);
    color: var(--text-secondary);
    text-align: center;
}

.about-text strong {
    color: var(--text-primary);
}

.about-inline-link {
    margin-left: var(--spacing-xs);
    color: var(--secondary-color);
    font-weight: 600;
    text-decoration: none;
    border-bottom: 1px solid transparent;
    transition: var(--transition-fast);
}

.about-inline-link:hover,
.about-inline-link:focus-visible {
    color: var(--secondary-dark);
    border-bottom-color: currentColor;
}


.control-panel {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-lg);
    padding: var(--spacing-xl) 25px;
    background: var(--bg-white);
    border-bottom: none;
    align-items: flex-start;
}

/* Ensure the panel title and each control-row occupy a full row inside .control-panel
   so controls align to the left and avoid large empty gutters. */
.control-panel > .panel-title,
.control-panel > .control-row {
    flex: 1 1 100%;
}

/* Ensure the comparison-controls wrapper spans full row like control-row */
.control-panel > .comparison-controls {
    flex: 1 1 100%;
}

/* Collapsible control-panel: hide rows when collapsed to save vertical space */
.control-panel.collapsed .control-row,
.control-panel.collapsed .sample-selection-panel,
.control-panel.collapsed .comparison-controls {
    display: none;
}

.control-panel.collapsed > :not(.panel-title) {
    display: none;
}

/* Ensure the toggle button in panel title aligns visually */
.panel-title .toggle-btn {
    margin-left: var(--spacing-md);
    padding: var(--spacing-sm) 10px;
}

/* Theme panel */
.theme-panel-title {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: var(--spacing-md);
}

.theme-panel-title-text {
    display: flex;
    flex-direction: column;
    gap: 2px;
}

.theme-panel-title .panel-subtitle {
    font-size: var(--font-sm);
    color: var(--text-light);
    font-weight: 400;
}

.theme-panel-body {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
    margin-top: var(--spacing-lg);
}

.control-panel.collapsed .theme-panel-body {
    display: none;
}

.theme-panel-text {
    font-size: var(--font-sm);
    color: var(--text-secondary);
    line-height: 1.5;
}

.theme-preset-list {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--spacing-md);
}

@media (max-width: 640px) {
    .theme-preset-list {
        grid-template-columns: 1fr;
    }
}

.theme-chip {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
    padding: var(--spacing-md);
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
    background: var(--bg-light);
    cursor: pointer;
    transition: var(--transition-base);
    text-align: left;
}

.theme-chip:hover {
    border-color: var(--primary-color);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
}

.theme-chip.active {
    border-color: var(--primary-color);
    box-shadow: inset 0 0 0 1px var(--primary-color);
    background: var(--bg-white);
}

.theme-chip-name {
    font-weight: 600;
    font-size: var(--font-md);
    color: var(--text-primary);
}

.theme-chip-desc {
    font-size: var(--font-sm);
    color: var(--text-light);
}

.theme-chip-swatches {
    display: flex;
    gap: 4px;
}

.theme-chip-swatch {
    flex: 1;
    height: 6px;
    border-radius: 999px;
}

.custom-theme-card {
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
    background: var(--bg-light);
}

.custom-theme-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
    color: var(--text-secondary);
}

.custom-theme-grid {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--spacing-md);
}

@media (max-width: 640px) {
    .custom-theme-grid {
        grid-template-columns: 1fr;
    }
}

.custom-theme-field {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
    background: var(--bg-white);
    font-size: var(--font-sm);
    color: var(--text-secondary);
}

.custom-theme-field span {
    flex: 1;
    min-width: 0;
}

.custom-theme-field input[type="color"] {
    width: 44px;
    height: 28px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    background: var(--bg-white);
    cursor: pointer;
    padding: 0;
}

.custom-theme-actions {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-md);
    justify-content: flex-end;
}

.btn-link {
    background: none;
    border: none;
    color: var(--secondary-color);
    font-size: var(--font-sm);
    cursor: pointer;
    padding: 0;
    text-decoration: underline;
}

.zero-color-control {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.zero-color-control label {
    margin: 0;
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.zero-color-input {
    width: 48px;
    height: 30px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    cursor: pointer;
    padding: 0;
}

.zero-color-input.disabled {
    opacity: 0.45;
    cursor: not-allowed;
}

.btn-link:hover {
    color: var(--secondary-dark);
}

/* Modal overlay for expanded comparison view */
.comparison-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    -webkit-backdrop-filter: blur(4px);
    backdrop-filter: blur(4px);
}

.comparison-modal-content {
    width: 90%;
    height: 90%;
    background: var(--bg-white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-xl);
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

.comparison-modal-header {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    padding: 10px 14px;
    border-bottom: 1px solid var(--border-light);
    background: var(--bg-light);
    position: relative;
}

/* Modal header actions (export icons + close) */
.comparison-modal-header .modal-actions {
    margin-left: auto;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.comparison-modal-header .btn-icon {
    width: 28px;
    height: 28px;
    background: transparent;
    color: var(--text-secondary);
    border: none;
    box-shadow: none;
    transition: color 0.15s ease, background 0.15s ease;
}

.comparison-modal-header .btn-icon:hover {
    color: var(--text-primary);
    background: rgba(0, 0, 0, 0.06);
}

.modal-title {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    font-weight: 700;
    font-size: var(--font-lg);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: calc(100% - 120px);
}

.comparison-modal-body {
    flex: 1 1 auto;
    padding: 10px;
    overflow: auto;
    display: flex;            /* ensure inner wrapper can flex and be constrained */
    flex-direction: column;
    min-height: 0;            /* allow children to shrink below content height (fixes inner scrollbar placement) */
}

/* Wrapper for comparison results table inside modal. Make it the scrolling container
   so horizontal scrollbar remains visible without having to scroll the outer modal. */
.comparison-results-table-wrapper {
    flex: 1 1 auto;
    min-height: 0;           /* important for flex children to respect container height */
    overflow: auto;          /* allow both horizontal and vertical scroll inside wrapper */
    padding: 6px;
}

/* Allow wide tables to determine their own width while still supporting a minimum
   fill of the wrapper width. This makes horizontal scrolling appear on the wrapper. */
.comparison-results-table-wrapper table.info-sample-table {
    width: max-content;
    min-width: 100%;
}

.comparison-modal-close {
    margin-left: auto;
    background: var(--text-primary);
    color: var(--bg-white);
    border: none;
    font-size: var(--font-md);
    cursor: pointer;
    padding: var(--spacing-sm) 10px;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-md);
    transition: var(--transition-fast);
    font-weight: 600;
}

.comparison-modal-close:hover {
    background: #000;
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
}


/* 卡片式面板 */
.card-panel {
    background: linear-gradient(135deg, #fafbfd 0%, #f8f9fb 100%);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    padding: 0;
    margin-bottom: 0;
    transition: var(--transition-base);
    overflow: hidden;
}

.card-panel:hover {
    box-shadow: var(--shadow-md);
    border-color: #d4dae3;
    background: linear-gradient(135deg, #ffffff 0%, #fafbfd 100%);
}

.panel-title {
    font-weight: 600;
    font-size: var(--font-md);
    color: var(--text-primary);
    padding: var(--spacing-md) var(--spacing-lg);
    background: linear-gradient(135deg, #f0f3f7 0%, #e8ecf1 100%);
    border-bottom: 1px solid var(--border-color);
    margin: 0;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
}

.panel-title::after {
    display: none;
}

.control-row {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-lg);
    padding: var(--spacing-md) var(--spacing-lg);
    align-items: center;
    border-bottom: 1px solid var(--border-light);
    transition: var(--transition-fast);
}

.control-row:last-child {
    border-bottom: none;
}

.control-row:hover {
    background-color: transparent;
}



/* 分组显示区域 */
.group-display {
    margin: 10px 0;
    padding: 12px;
    background: #f8f9fa;
    border: 1px solid #e8ebf0;
    border-radius: 8px;
    max-height: 180px;
    overflow-y: auto;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 8px;
    width: 100%;
    box-sizing: border-box;
}

.group-display > div {
    padding: 8px 12px;
    background: linear-gradient(135deg, #fafbfd 0%, #f8f9fb 100%);
    border-radius: 6px;
    font-size: 13px;
    border: 1px solid #e0e6ed;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
    transition: all 0.2s ease;
}

.group-display > div:hover {
    border-color: var(--text-secondary);
    box-shadow: var(--shadow-sm);
    transform: none;
    background: linear-gradient(135deg, #ffffff 0%, #fafbfd 100%);
}


.full-width {
    flex: 1 1 100%;
}

.control-group {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap; /* allow controls to wrap within sidebar width */
}

.control-group.vertical {
    flex-direction: column;
    align-items: flex-start;
}

/* Prevent sidebar content from bleeding horizontally; enable scroll for wide inner blocks */
.sidebar .control-row,
.sidebar .collapsible-content,
.sidebar .group-display,
.sidebar #matrix-group-checkboxes,
.sidebar #color-previews-wrapper,
.sidebar #custom-color-controls,
.sidebar #sample-selection-panel {
    max-width: 100%;
    overflow-x: auto;
}

/* Inputs/selects should not overflow the sidebar */
.sidebar input[type="number"],
.sidebar input[type="text"],
.sidebar select {
    max-width: 100%;
}

#custom-color-group input[type="color"] {
    width: 50px;
    height: 32px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    cursor: pointer;
    padding: 2px;
    transition: var(--transition-fast);
    box-shadow: var(--shadow-sm);
}

#custom-color-group input[type="color"]:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-md);
    transform: translateY(-1px);
}

/* Ensure custom color controls behave inside sidebar when shown */
#custom-color-controls.flex {
    /* display is controlled by JS (setColorScheme). Do not override here. */
    flex-wrap: wrap;
    align-items: center;
    gap: var(--spacing-sm);
}

#custom-color-controls input[type="color"] {
    width: 44px;
    height: 28px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: 2px;
    box-shadow: var(--shadow-sm);
    cursor: pointer;
}

#custom-color-controls input[type="color"]:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-md);
}

#custom-color-controls label,
#custom-color-controls select,
#custom-color-controls button,
#custom-color-controls span {
    max-width: 100%;
}

.control-group label {
    font-weight: 500;
    /* color: var(--text-primary); */
    font-size: var(--font-md);
}

/* ========== 统一表单元素样式 ========== */
select {
    padding: 8px var(--spacing-md);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    font-size: var(--font-md);
    background: var(--bg-white);
    cursor: pointer;
    transition: var(--transition-fast);
    box-shadow: var(--shadow-sm);
    font-weight: 500;
    color: var(--text-primary);
}

select:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-md);
}

select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(74, 85, 104, 0.1);
}

input[type="range"] {
    width: 100px;
    margin: 0 var(--spacing-sm);
    cursor: pointer;
    accent-color: var(--primary-color);
}

input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
    margin-right: var(--spacing-sm);
    accent-color: var(--primary-color);
}

input[type="number"],
input[type="text"] {
    padding: 8px 10px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    font-size: var(--font-base);
    transition: var(--transition-fast);
    box-shadow: var(--shadow-sm);
    color: var(--text-primary);
}

input[type="number"] {
    width: 60px;
}

input[type="number"]:focus,
input[type="text"]:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(74, 85, 104, 0.1);
}

.control-group span[id$="-value"] {
    display: inline-block;
    min-width: 40px;
    font-weight: 600;
    color: var(--primary-color);
    font-size: var(--font-sm);
}

input[type="file"] {
    display: none;
}

.file-upload-label {
    background: var(--gradient-primary);
    color: white;
    padding: 10px var(--spacing-xl);
    border-radius: var(--radius-lg);
    cursor: pointer;
    font-weight: 600;
    transition: var(--transition-base);
    display: inline-block;
    font-size: var(--font-md);
    box-shadow: var(--shadow-md);
}

.file-upload-label:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-primary);
    background: var(--gradient-primary-hover);
}

/* ========== 统一按钮样式 ========== */
button {
    padding: 8px 14px;
    border: none;
    border-radius: var(--radius-md);
    font-size: var(--font-base);
    background: var(--gradient-primary);
    color: white;
    cursor: pointer;
    transition: var(--transition-fast);
    font-weight: 600;
    box-shadow: var(--shadow-sm);
    font-family: inherit;
}

button:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-primary);
    background: var(--gradient-primary-hover);
}

button:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(74, 85, 104, 0.15);
}

button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
}

.btn-secondary {
    background: var(--bg-white);
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
}

.btn-secondary:hover {
    background: var(--primary-color);
    color: white;
    box-shadow: var(--shadow-primary);
}

/* ========== 帮助图标 ========== */
.help-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 16px;
    height: 16px;
    color: var(--text-light);
    cursor: help;
    margin-left: var(--spacing-xs);
    transition: var(--transition-fast);
}

.help-icon:hover {
    color: var(--text-secondary);
}

.label-with-help {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
}

.info-icon-btn {
    border: none;
    background: transparent;
    padding: 2px;
    width: 22px;
    height: 22px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    color: var(--text-light);
    cursor: pointer;
    border-radius: 50%;
    transition: var(--transition-fast);
    box-shadow: none;
}

.info-icon-btn:hover,
.info-icon-btn:focus-visible {
    color: var(--primary-color);
    background: rgba(102, 116, 219, 0.12);
    outline: none;
}

.info-icon-btn svg {
    pointer-events: none;
}

.info-modal {
    position: fixed;
    inset: 0;
    z-index: 1600;
    display: none;
    align-items: center;
    justify-content: center;
}

.info-modal.is-visible {
    display: flex;
}

.info-modal-overlay {
    position: absolute;
    inset: 0;
    background: rgba(15, 23, 42, 0.55);
}

.info-modal-content {
    position: relative;
    z-index: 1;
    background: var(--bg-white);
    border-radius: var(--radius-2xl);
    box-shadow: 0 18px 40px rgba(15, 23, 42, 0.2);
    width: min(680px, 94vw);
    max-height: 85vh;
    padding: var(--spacing-2xl);
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
}

.info-modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-md);
}

.info-modal-header h3 {
    margin: 0;
    font-size: var(--font-2xl);
}

.info-modal-close {
    border: none;
    background: transparent;
    font-size: 26px;
    line-height: 1;
    color: var(--text-light);
    cursor: pointer;
    padding: 4px 8px;
    border-radius: var(--radius-md);
    transition: var(--transition-fast);
}

.info-modal-close:hover,
.info-modal-close:focus-visible {
    color: var(--primary-color);
    background: rgba(102, 116, 219, 0.12);
    outline: none;
}

.info-modal-body {
    font-size: var(--font-md);
    color: var(--text-secondary);
    line-height: 1.7;
    display: flex;
    flex-direction: column;
    gap: var(--spacing-lg);
}

.info-example {
    border: 1px solid var(--border-light);
    border-radius: var(--radius-xl);
    background: var(--bg-lighter);
    padding: var(--spacing-lg);
    box-shadow: var(--shadow-sm);
}

.info-example-title {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: var(--spacing-sm);
}

.info-modal-body pre {
    background: #0f172a;
    color: #f8fafc;
    border-radius: var(--radius-md);
    padding: var(--spacing-md);
    overflow-x: auto;
    font-family: 'Fira Code', 'SFMono-Regular', Consolas, monospace;
    font-size: 12px;
    margin: var(--spacing-sm) 0;
}

.info-table-wrapper {
    overflow-x: auto;
    margin-top: var(--spacing-sm);
}

.info-sample-table {
    width: 100%;
    border-collapse: collapse;
    font-size: var(--font-sm);
    background: white;
    border-radius: var(--radius-lg);
    overflow: hidden;
}

.info-sample-table th,
.info-sample-table td {
    border: 1px solid var(--border-light);
    padding: 8px 10px;
    text-align: left;
    white-space: nowrap;
}

.info-sample-table thead {
    background: rgba(102, 116, 219, 0.08);
    color: var(--text-primary);
}

.info-sample-table tbody tr:nth-child(even) {
    background: var(--bg-lighter);
}

/* 排序指示器（简约风格） */
.info-sample-table th {
    cursor: pointer;
    position: relative;
    padding-right: 28px; /* 留出空间给箭头 */
    -webkit-user-select: none; /* 支持 Safari / iOS Safari 3+ */
    user-select: none;
}

.info-sample-table th::after {
    content: '';
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    font-size: 10px;
    color: var(--text-light);
    opacity: 0.9;
    transition: transform 0.12s ease, color 0.12s ease, opacity 0.12s ease;
}

.info-sample-table th.sorted-asc::after {
    content: '▲';
    color: var(--primary-color);
    transform: translateY(-50%) translateY(-1px);
}

.info-sample-table th.sorted-desc::after {
    content: '▼';
    color: var(--primary-color);
    transform: translateY(-50%) translateY(1px);
}

.info-sample-table th:hover::after {
    color: var(--primary-dark);
    opacity: 1;
}

.info-modal-list {
    margin: var(--spacing-sm) 0 0;
    padding-left: var(--spacing-xl);
    display: flex;
    flex-direction: column;
    gap: 4px;
}

.info-modal-list li {
    list-style: disc;
}

@media (max-width: 640px) {
    .info-modal-content {
        width: 92vw;
        padding: var(--spacing-xl);
    }
}

/* ========== 可视化容器 ========== */
.viz-container {
    position: relative;
    padding: clamp(var(--spacing-lg), 4vw, var(--spacing-3xl));
    background: var(--bg-white);
    --panel-grid-gap: var(--spacing-xl);
    display: grid;
    grid-template-columns: repeat(
        auto-fit,
        minmax(
            min(var(--panel-min-width, 600px), 100%),
            1fr
        )
    );
    gap: var(--panel-grid-gap);
    justify-content: center;

    /* 新增：确保每一行至少有固定最小高度，便于控制面板高度 */
    grid-auto-rows: minmax(var(--panel-min-height), auto);
    align-items: start;
}

.tree-panel {
    position: relative;
    border: 1px solid var(--tree-panel-border, var(--border-color));
    border-radius: var(--radius-lg);
    background: var(--tree-panel-bg, #fafbfd);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    transition: var(--transition-base);
}

.tree-panel:hover {
    box-shadow: var(--shadow-md);
    border-color: var(--tree-panel-hover-border, var(--tree-panel-border, #d4dae3));
}

.tree-panel-header {
    /* 使用纯色背景，移除渐变 */
    background: var(--tree-panel-header-start, var(--primary-color));
    color: var(--tree-panel-header-text, #ffffff);
    padding: 10px var(--spacing-lg);
    font-weight: 600;
    font-size: var(--font-md);
    display: flex;
    align-items: center;
    justify-content: space-between; /* title centered via absolute; actions right */
    position: relative;
}

/* Title text inside header */
.tree-panel-header .panel-title-text {
    color: var(--tree-panel-header-text, #ffffff);
    font-weight: 700;
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    max-width: calc(100% - 120px);
    pointer-events: none;
}

/* Right-aligned action area */
.tree-panel-header .panel-actions {
    margin-left: auto;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

/* Make header icons subtle and blend with background */
.tree-panel-header .btn-icon {
    width: 28px;
    height: 28px;
    background: transparent;
    color: rgba(255, 255, 255, 0.75);
    border: none;
    box-shadow: none;
    transition: color 0.15s ease, background 0.15s ease, transform 0.15s ease;
}

.tree-panel-header .btn-icon:hover {
    color: #fff;
    background: rgba(255, 255, 255, 0.18);
    border: none;
    transform: none;
}

.tree-panel-header .btn-icon:active {
    background: rgba(255, 255, 255, 0.26);
}

/* Subtle back button inside the colored header */
.tree-panel-header .btn-back {
    background: transparent;
    color: var(--tree-panel-header-text, #ffffff);
    border: 1px solid rgba(255, 255, 255, 0.65);
    height: 28px;
    padding: 0 10px;
    border-radius: var(--radius-md);
    box-shadow: none;
}

.tree-panel-header .btn-back:hover {
    background: rgba(255, 255, 255, 0.18);
    color: var(--tree-panel-header-text, #ffffff);
    transform: none;
    box-shadow: none;
}

.tree-svg-container {
    width: 100%;
    /* 使用统一变量以便于高度统一配置；回退值改为更合理的默认值 */
    height: var(--panel-svg-height, 520px);
    position: relative;
}

#tree-visualization {
    display: none;
}


.sample-checkboxes {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-lg);
    align-items: center;
    max-height: calc(40vh - 40px);
    overflow-y: auto;
    padding-right: var(--spacing-sm);
}

.sample-selection-panel {
    background: linear-gradient(135deg, #fafbfd 0%, #f5f7fa 100%);
    border-top: 1px solid var(--border-light);
    border-bottom: 1px solid var(--border-light);
    padding: var(--spacing-xl) var(--spacing-3xl);
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-in-out, padding 0.3s ease-in-out;
}

.sample-selection-panel.expanded {
    max-height: 50vh;
    padding: var(--spacing-xl) var(--spacing-3xl);
    overflow-y: auto;
}

.toggle-btn {
    background: var(--gradient-primary);
    color: white;
    border: none;
    padding: var(--spacing-sm) 14px;
    border-radius: var(--radius-md);
    cursor: pointer;
    font-size: var(--font-sm);
    font-weight: 600;
    transition: var(--transition-fast);
    min-width: 90px;
    box-shadow: var(--shadow-sm);
}

.toggle-btn:hover {
    background: var(--gradient-primary-hover);
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
}

.toggle-btn.expanded {
    background: var(--gradient-primary-hover);
}

#color-previews-toggle::after {
    content: '▸';
    display: inline-block;
    margin-left: 4px;
    transition: var(--transition-fast);
}

#color-previews-toggle.expanded::after {
    content: '▾';
}

/* ========== Color scheme preview tiles ========== */
#color-previews {
    display: flex;
    gap: var(--spacing-sm);
    flex-wrap: wrap;
}

.color-preview {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--spacing-sm);
    cursor: pointer;
    -webkit-user-select: none;
    user-select: none;
    font-size: var(--font-sm);
    transition: var(--transition-fast);
}

.color-preview .swatches {
    display: flex;
    gap: 2px;
    border-radius: var(--radius-md);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    transition: var(--transition-fast);
}

.color-preview .swatch {
    width: 26px;
    height: 14px;
}

.color-preview.selected .swatches {
    outline: 2px solid var(--primary-color);
    outline-offset: 2px;
}

.color-preview:hover .swatches {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.checkbox-item {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    cursor: pointer;
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--radius-md);
    transition: var(--transition-fast);
    background: rgba(255, 255, 255, 0.3);
}

.checkbox-item:hover {
    background: rgba(91, 109, 138, 0.08);
}

.checkbox-item input[type="checkbox"] {
    width: 18px;
    height: 18px;
    cursor: pointer;
    accent-color: var(--primary-color);
}

.checkbox-item label {
    cursor: pointer;
    font-size: var(--font-md);
    font-weight: 500;
    color: var(--text-primary);
    -webkit-user-select: none;
    user-select: none;
}


/* ========== Tooltip 样式 ========== */
.tooltip {
    position: absolute;
    padding: var(--spacing-md) var(--spacing-lg);
    /* Slightly translucent black for a softer, modern look */
    background: rgba(0, 0, 0, 0.5);
    /* soft border helps tooltips stand out over varying backgrounds */
    border: 1px solid rgba(255, 255, 255, 0.06);
    color: white;
    border-radius: var(--radius-lg);
    /* allow pointer events so text can be selected; visibility is managed in JS to avoid flicker */
    pointer-events: auto;
    -webkit-user-select: text;
    user-select: text;
    font-size: var(--font-base);
    line-height: 1.6;
    opacity: 0;
    transition: opacity 0.3s;
    z-index: 10050;
    max-width: 300px;
    box-shadow: var(--shadow-xl);
    -webkit-backdrop-filter: blur(5px);
    backdrop-filter: blur(5px);
}

.tooltip.show {
    opacity: 1;
}

.tooltip-taxon {
    font-weight: bold;
    color: #64b5f6;
    margin-bottom: var(--spacing-sm);
}

.tooltip-abundance {
    color: #81c784;
}

/* Tooltip path (full_path) - allow long paths to wrap nicely inside the tooltip */
.tooltip-path {
    color: #ddd;
    margin-bottom: var(--spacing-sm);
    display: block;
    box-sizing: border-box;
    max-width: 100%;
    white-space: normal;         /* allow wrapping */
    /* Force breaks for very long tokens (no spaces) so they don't overflow */
    word-break: break-all;       /* break within words if needed */
    overflow-wrap: anywhere;     /* ensure very long tokens wrap */
}

/* ========== Legend 样式 ========== */
.legend {
    position: absolute;
    top: 60px;
    right: var(--spacing-xl);
    background: var(--bg-white);
    padding: var(--spacing-lg);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    font-size: var(--font-xs);
    z-index: 100;
}

.comparison-legend {
    display: block;
    padding: var(--spacing-lg) var(--spacing-xl);
    background: var(--bg-white);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-md);
    text-align: center;
    margin: var(--spacing-xl) auto;
    width: -moz-fit-content; /* Firefox fallback */
    width: fit-content;
}

#shared-legend.comparison-legend {
    grid-column: 1 / -1;
    justify-self: center;
    align-self: start;
}

.shared-legend {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    margin: var(--spacing-md) auto var(--spacing-2xl) auto;
    width: 100%;
    max-width: 720px;
    pointer-events: none;
}

.shared-legend .legend-bar {
    width: 100%;
    height: 14px;
    border-radius: var(--radius-md);
    box-shadow: var(--shadow-sm);
    border: 1px solid rgba(0, 0, 0, 0.06);
}

.shared-legend .legend-labels {
    width: 100%;
    display: flex;
    justify-content: space-between;
    margin-top: var(--spacing-sm);
    font-size: var(--font-sm);
    color: var(--text-secondary);
}

.shared-legend .transform-hint {
    margin: 0 var(--spacing-sm);
    font-size: var(--font-xs);
    color: var(--text-light);
    text-align: center;
}

.legend-title {
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--text-primary);
    font-size: var(--font-sm);
    text-align: center;
}

.legend-item {
    margin: var(--spacing-sm) 0;
    display: flex;
    align-items: center;
    gap: 10px;
}

.legend-gradient {
    width: 360px;
    height: 20px;
    border-radius: var(--radius-sm);
    margin: var(--spacing-sm) auto 0 auto;
}

.legend-labels {
    width: 360px;
    display: flex;
    justify-content: space-between;
    margin: var(--spacing-xs) auto 0 auto;
    font-size: var(--font-xs);
    color: var(--text-secondary);
}

.legend-description {
    margin-top: 10px;
    font-size: var(--font-xs);
    color: var(--text-secondary);
    text-align: center;
}


/* ========== 统计面板 ========== */
.stats-panel {
    background: var(--gradient-bg);
    padding: var(--spacing-xl) var(--spacing-3xl);
    border-top: 1px solid var(--border-light);
    display: flex;
    gap: 40px;
    flex-wrap: wrap;
    justify-content: center; /* 居中对齐每个统计项 */
}

.stat-item {
    flex: 1;
    min-width: 150px;
    display: flex;
    flex-direction: column;
    align-items: center;   /* 水平居中内容 */
    text-align: center;    /* 文本居中 */
}

.stat-label {
    font-size: var(--font-sm);
    color: var(--text-secondary);
    margin-bottom: var(--spacing-sm);
    font-weight: 500;
}

.stat-value {
    font-size: var(--font-4xl);
    font-weight: 700;
    color: var(--primary-color);
}

.filename-display {
    color: var(--text-secondary);
    font-size: var(--font-base);
    font-style: italic;
    max-width: 240px;              /* keep text concise beside buttons */
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}


/* ========== 响应式设计 ========== */
@media (max-width: 768px) {
    .app-body { flex-direction: column; padding: var(--spacing-lg); gap: var(--spacing-lg); }
    .sidebar { flex: none; min-width: unset; max-width: none; border-right: none; border-bottom: 1px solid var(--border-light); padding-right: 0; overflow-x: auto; }
    .main-content { padding-right: 0; position: static; height: auto; overflow: visible; }
    .sidebar-toggle { align-self: flex-end; margin: var(--spacing-md) 0 0 auto; }
    .app-body.sidebar-collapsed .main-content { padding-left: 0; }
    body {
        padding: var(--spacing-md);
    }
    
    .header h1 {
        font-size: var(--font-4xl);
    }
    
    .header p {
        font-size: var(--font-sm);
    }

    .about-section {
        margin: var(--spacing-md) var(--spacing-sm);
        padding: var(--spacing-md);
    }
    
    .control-panel {
        flex-direction: column;
        align-items: stretch;
        padding: var(--spacing-lg) var(--spacing-xl);
    }

    .control-group {
        flex-direction: column;
        align-items: stretch;
    }

    #tree-visualization {
        height: 600px;
    }

    .legend {
        position: relative;
        top: auto;
        right: auto;
        margin: var(--spacing-xl) 0;
    }

    .legend-gradient,
    .legend-labels {
        width: 260px;
    }
    
    .viz-container {
        padding: var(--spacing-xl);
        gap: var(--spacing-lg);
    }
}

/* ========== SVG节点和连线样式 ========== */
.node circle {
    cursor: pointer;
    transition: var(--transition-base);
}

.node circle:hover {
    stroke-width: 3px;
}

.link {
    fill: none;
    transition: var(--transition-base);
}

.node text {
    font-size: var(--font-xs);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

/* ========== 加载状态 ========== */
.loading {
    text-align: center;
    padding: 40px;
    color: var(--text-secondary);
    font-size: var(--font-xl);
}



/* ========== 比较模式按钮样式 ========== */
.btn-run-comparison {
    padding: 10px var(--spacing-2xl);
    background: var(--gradient-success);
    color: white;
    border: none;
    border-radius: var(--radius-lg);
    font-weight: 600;
    font-size: var(--font-md);
    cursor: pointer;
    transition: var(--transition-fast);
    box-shadow: var(--shadow-md);
}

.btn-run-comparison:hover {
    background: linear-gradient(135deg, #229954 0%, #1e8449 100%);
    transform: translateY(-1px);
    box-shadow: var(--shadow-success);
}

.btn-export-comparison {
    padding: var(--spacing-sm) 18px;
    background: var(--gradient-info);
    color: white;
    border: none;
    border-radius: var(--radius-lg);
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition-fast);
    box-shadow: var(--shadow-md);
}

.btn-export-comparison:hover {
    background: linear-gradient(135deg, #2980b9 0%, #21618c 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
}

/* ========== 图标按钮（紧凑样式） ========== */
.btn-icon {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
    padding: 0;
    border-radius: var(--radius-md);
    background: var(--bg-white);
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
    transition: var(--transition-fast);
    cursor: pointer;
    box-shadow: var(--shadow-sm);
}

.btn-icon:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
    border-color: var(--primary-color);
    color: var(--primary-color);
}

.btn-icon-danger {
    color: var(--danger-color);
    border-color: #fde8e7;
}

.btn-icon-danger:hover {
    color: var(--bg-white);
    background: var(--gradient-danger);
    border-color: var(--danger-dark);
    box-shadow: 0 3px 8px rgba(231, 76, 60, 0.3);
}

/* ========== 图标按钮（主色强调样式） ========== */
.btn-icon-primary {
    color: var(--primary-color);
    border-color: var(--primary-color);
}

.btn-icon-primary:hover {
    color: var(--bg-white);
    background: var(--gradient-primary);
    border-color: var(--primary-dark);
    box-shadow: var(--shadow-primary);
}

/* ========== 小按钮样式 ========== */
.btn-small {
    background: var(--gradient-primary);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    padding: var(--spacing-xs) 10px;
    font-size: var(--font-sm);
    cursor: pointer;
    transition: var(--transition-fast);
    box-shadow: var(--shadow-sm);
    font-weight: 600;
}

/* ========== Utility classes (replacing inline styles) ========== */
.flex { display: flex; }
.flex-wrap { flex-wrap: wrap; }
.ai-center { align-items: center; }
.justify-between { justify-content: space-between; }
.gap-6 { gap: 6px; }
.gap-5 { gap: 5px; }
.gap-8 { gap: 8px; }
.gap-12 { gap: 12px; }
.mt-6 { margin-top: 6px; }
.mt-8 { margin-top: 8px; }
.mb-6 { margin-bottom: 6px; }
.ml-8 { margin-left: 8px; }
.ml-10 { margin-left: 10px; }
.ml-12 { margin-left: 12px; }
.ml-auto { margin-left: auto; }
.mx-3 { margin-left: 3px; margin-right: 3px; }
.mx-4 { margin-left: 4px; margin-right: 4px; }
.mr-8 { margin-right: 8px; }

.w-50 { width: 50px; }
.w-60 { width: 60px; }
.w-65 { width: 65px; }
.w-100 { width: 100%; }
.w-120 { width: 120px; }
.w-140 { width: 140px; }
.w-180 { width: 180px; }
.minw-140 { min-width: 140px; }
.minw-160 { min-width: 160px; }

.p-6 { padding: 6px; }
.pad-8-12 { padding: 8px 12px; }

.bg-light-surface { background: #f8f9fa; }
.br-4 { border-radius: 4px; }
.maxh-100 { max-height: 100px; }
.overflow-y-auto { overflow-y: auto; }

/* Grid utilities */
.grid { display: grid; }
.grid-auto-120 { grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); }

.text-muted { color: #666; }
.text-light { color: #999; }
.fs-12 { font-size: 12px; }
.fs-13 { font-size: 13px; }
.fw-500 { font-weight: 500; }

/* Defaults for collapsible/hidden sections (was inline style="display:none;") */
#meta-filters-content,
#color-previews-wrapper,
#custom-color-controls,
#custom-color-mid,
#custom-arrow-mid,
#data-params-content,
#sample-selection-panel,
#comparison-controls,
#group-mode-settings,
#matrix-group-selection,
#significance-thresholds-row,
#export-comparison,
#stats-panel {
    display: none;
}

/* Section divider and titles (replacing inline styles) */
.section-divider { margin-top: 30px; padding-top: 20px; border-top: 2px solid #e0e0e0; }
.section-title { font-weight: 600; margin-bottom: 15px; color: #2c3e50; }

.btn-small:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-md);
    background: var(--gradient-primary-hover);
}

.custom-delimiter-input {
    display: none;
    width: 100%;
}

.custom-delimiter-input.visible {
    display: block;
}

.btn-small:active {
    transform: translateY(0);
    box-shadow: var(--shadow-sm);
}


/* ========== 分组显示区域 ========== */
.group-display {
    margin: 10px 0;
    padding: var(--spacing-md);
    background: var(--bg-light);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    max-height: 180px;
    overflow-y: auto;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: var(--spacing-sm);
    width: 100%;
    box-sizing: border-box;
}

.group-display > div {
    padding: var(--spacing-sm) var(--spacing-md);
    background: var(--bg-white);
    border-radius: var(--radius-md);
    font-size: var(--font-base);
    border: 1px solid var(--border-color);
    box-shadow: var(--shadow-sm);
    transition: var(--transition-fast);
}

.group-display > div:hover {
    border-color: var(--primary-color);
    box-shadow: var(--shadow-md);
    transform: translateY(-1px);
}

.group-toolbar {
    margin-top: var(--spacing-sm);
    display: flex;
    align-items: center;
    justify-content: flex-end;
}

#group-definitions-display {
    max-height: 200px;
    overflow-y: auto;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: var(--spacing-sm);
}

#group-definitions-display > div {
    margin: 0 !important;
    padding: var(--spacing-sm) 10px !important;
    background: rgba(255, 255, 255, 0.2) !important;
    border-radius: var(--radius-md) !important;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

#existing-groups-list {
    max-height: 260px;
    overflow-y: auto;
}

/* ========== 可折叠面板（元数据筛选） ========== */
.control-group.collapsible {
    padding: var(--spacing-md) var(--spacing-lg);
    border-bottom: 1px solid var(--border-light);
}

.collapsible .collapsible-header {
    display: flex;
    align-items: center;
    gap: 10px;
}

.collapsible .collapsible-title {
    font-weight: 600;
    color: var(--text-primary);
    font-size: var(--font-md);
}

.collapsible .collapsible-content {
    margin-top: var(--spacing-sm);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    padding: var(--spacing-md);
    background: linear-gradient(135deg, #f8f9fb 0%, #f3f5f8 100%);
    box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.03);
}

#samples-toggle-group {
    margin-top: var(--spacing-sm);
}


/* ========== 自定义滚动条样式 ========== */
.group-display::-webkit-scrollbar,
#existing-groups-list::-webkit-scrollbar,
#group-definitions-display::-webkit-scrollbar,
.collapsible-content::-webkit-scrollbar,
.sample-checkboxes::-webkit-scrollbar,
#matrix-group-checkboxes::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

.group-display::-webkit-scrollbar-track,
#existing-groups-list::-webkit-scrollbar-track,
#group-definitions-display::-webkit-scrollbar-track,
.collapsible-content::-webkit-scrollbar-track,
.sample-checkboxes::-webkit-scrollbar-track,
#matrix-group-checkboxes::-webkit-scrollbar-track {
    background: #f1f3f5;
    border-radius: 3px;
}

.group-display::-webkit-scrollbar-thumb,
#existing-groups-list::-webkit-scrollbar-thumb,
#group-definitions-display::-webkit-scrollbar-thumb,
.collapsible-content::-webkit-scrollbar-thumb,
.sample-checkboxes::-webkit-scrollbar-thumb,
#matrix-group-checkboxes::-webkit-scrollbar-thumb {
    background: var(--gradient-primary);
    border-radius: 3px;
    transition: var(--transition-fast);
}

.group-display::-webkit-scrollbar-thumb:hover,
#existing-groups-list::-webkit-scrollbar-thumb:hover,
#group-definitions-display::-webkit-scrollbar-thumb:hover,
.collapsible-content::-webkit-scrollbar-thumb:hover,
.sample-checkboxes::-webkit-scrollbar-thumb:hover,
#matrix-group-checkboxes::-webkit-scrollbar-thumb:hover {
    background: var(--gradient-primary-hover);
}

/* ========== 输入框焦点增强效果 ========== */
input[type="range"]:focus,
input[type="checkbox"]:focus {
    outline: 2px solid rgba(74, 85, 104, 0.2);
    outline-offset: 2px;
    border-radius: 2px;
}

/* ========== 微调动画 ========== */
@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.card-panel {
    animation: fadeIn 0.3s ease-out;
}

/* ========== Matrix 组选择样式 ========== */
#matrix-group-checkboxes label {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    padding: var(--spacing-xs) var(--spacing-sm);
    background: var(--bg-white);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: var(--transition-fast);
    font-size: var(--font-sm);
}

#matrix-group-checkboxes label:hover {
    background: var(--bg-light);
    border-color: var(--text-secondary);
}

#matrix-group-checkboxes input[type="checkbox"] {
    cursor: pointer;
}
/* ========== Taxon 筛选样式 ========== */
.taxon-filter-box {
    max-height: 120px;
    overflow-y: auto;
    overflow-x: hidden;
    border: 1px solid var(--border-color);
    padding: 6px;
    background: #f9f9f9;
    border-radius: var(--radius-sm);
    font-size: 10px;
    word-break: break-all;
    width: 100%;
    box-sizing: border-box;
}

.taxon-filter-box.filter-list {
    background: var(--bg-white);
    max-height: 100px;
}

.taxon-filter-expand-btn {
    margin-left: 8px;
    padding: 2px 8px;
    font-size: 11px;
    cursor: pointer;
    background: var(--primary-color);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    transition: var(--transition-fast);
}

.taxon-filter-expand-btn:hover {
    background: var(--primary-dark);
}

.taxon-filter-box::-webkit-scrollbar {
    width: 6px;
}

.taxon-filter-box::-webkit-scrollbar-track {
    background: #f1f3f5;
    border-radius: 3px;
}

.taxon-filter-box::-webkit-scrollbar-thumb {
    background: var(--gradient-primary);
    border-radius: 3px;
}

.taxon-item {
    padding: 4px 6px;
    margin: 2px 0;
    background: var(--bg-white);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-sm);
    font-family: 'Courier New', monospace;
    font-size: 10px;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    transition: var(--transition-fast);
    width: 100%;
    box-sizing: border-box;
}

.taxon-item:hover {
    background: var(--bg-light);
    border-color: var(--primary-color);
}

.taxon-item-name {
    flex: 1;
    min-width: 0;
    word-wrap: break-word;
    overflow-wrap: break-word;
    word-break: break-all;
    font-size: 10px;
    line-height: 1.3;
}

.taxon-item-remove {
    cursor: pointer;
    color: var(--danger-color);
    font-weight: bold;
    padding: 0 4px;
    margin-left: 4px;
    border-radius: 2px;
    transition: var(--transition-fast);
    flex-shrink: 0;
    font-size: 14px;
}

.taxon-item-remove:hover {
    background: var(--danger-color);
    color: white;
}

#taxon-search-input {
    width: 100%;
}

.flex-1 {
    flex: 1;
}

/* Taxon 编辑弹窗 */
.taxon-edit-modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.6);
    -webkit-backdrop-filter: blur(3px);
    backdrop-filter: blur(3px);
}

.taxon-edit-modal-content {
    background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
    margin: 5% auto;
    padding: 0;
    border: none;
    border-radius: 12px;
    width: 80%;
    max-width: 800px;
    max-height: 80vh;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    display: flex;
    flex-direction: column;
}

.taxon-edit-modal-header {
    background: var(--gradient-primary);
    color: white;
    padding: 20px 24px;
    border-radius: 12px 12px 0 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.taxon-edit-modal-header h3 {
    margin: 0;
    font-size: 20px;
    font-weight: 600;
}

.taxon-edit-modal-close {
    color: white;
    font-size: 32px;
    font-weight: bold;
    cursor: pointer;
    border: none;
    background: none;
    padding: 0;
    width: 32px;
    height: 32px;
    line-height: 28px;
    text-align: center;
    border-radius: 50%;
    transition: var(--transition-fast);
}

.taxon-edit-modal-close:hover {
    background: rgba(255, 255, 255, 0.2);
}

.taxon-edit-modal-body {
    padding: 24px;
    overflow-y: auto;
    flex: 1;
}

.taxon-edit-list {
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    padding: 8px;
    background: white;
    margin-bottom: 16px;
}

.taxon-edit-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 8px 12px;
    margin: 4px 0;
    background: var(--bg-light);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-sm);
    font-family: 'Courier New', monospace;
    font-size: 12px;
    transition: var(--transition-fast);
}

.taxon-edit-item:hover {
    background: white;
    border-color: var(--primary-color);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

.taxon-edit-item-name {
    flex: 1;
    word-break: break-all;
    margin-right: 12px;
}

.taxon-edit-item-remove {
    cursor: pointer;
    color: white;
    background: var(--danger-color);
    padding: 4px 10px;
    border-radius: var(--radius-sm);
    font-weight: 600;
    font-size: 14px;
    transition: var(--transition-fast);
    border: none;
    min-width: 60px;
}

.taxon-edit-item-remove:hover {
    background: var(--danger-dark);
    transform: scale(1.05);
}

.taxon-manual-add {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-top: 16px;
    padding-top: 16px;
    border-top: 2px solid var(--border-color);
}

.taxon-manual-add input {
    flex: 1;
    padding: 8px 12px;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    font-size: 13px;
}

.taxon-manual-add button {
    padding: 8px 16px;
    background: var(--success-color);
    color: white;
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-weight: 600;
    transition: var(--transition-fast);
}

.taxon-manual-add button:hover {
    background: var(--success-dark);
}

.taxon-edit-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 20px;
    padding-top: 16px;
    border-top: 2px solid var(--border-color);
}

.taxon-edit-actions button {
    padding: 10px 24px;
    border: none;
    border-radius: var(--radius-sm);
    cursor: pointer;
    font-weight: 600;
    font-size: 14px;
    transition: var(--transition-fast);
}

.taxon-edit-actions .btn-primary {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white;
}

.taxon-edit-actions .btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(88, 86, 214, 0.3);
}

.taxon-edit-actions .btn-secondary {
    background: var(--bg-light);
    color: var(--text-secondary);
    border: 1px solid var(--border-color);
}

.taxon-edit-actions .btn-secondary:hover {
    background: var(--border-light);
}

.taxon-edit-stats {
    text-align: center;
    padding: 12px;
    background: var(--bg-light);
    border-radius: var(--radius-sm);
    margin-bottom: 16px;
    font-size: 14px;
    color: var(--text-secondary);
}

.taxon-edit-stats strong {
    color: var(--primary-color);
    font-size: 18px;
}

/* ========== 右键菜单 - 标签颜色 ========== */
.context-menu {
    position: fixed;
    background: white;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    z-index: 10060;
    min-width: 240px;
    padding: 0;
    display: none;
}

.context-menu-header {
    padding: 12px 16px;
    font-weight: 600;
    font-size: 13px;
    color: var(--text-primary);
    border-bottom: 1px solid var(--border-light);
    background: var(--bg-light);
}

.context-menu-section {
    padding: 12px 16px;
}

.context-menu-label {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    margin: 0;
    font-size: 13px;
    font-weight: 500;
}

.context-menu-label span {
    margin-right: 12px;
}

.context-menu-label input[type="color"] {
    cursor: pointer;
    border: 1px solid var(--border-color);
    background: transparent;
    width: 60px;
    height: 36px;
    border-radius: 4px;
    padding: 2px;
}

.context-menu-label input[type="color"]:hover {
    border-color: var(--primary-color);
}

.context-menu-actions {
    display: flex;
    gap: 6px;
    padding: 12px 16px;
    border-top: 1px solid var(--border-light);
    background: white;
}

.context-menu-btn {
    flex: 1;
    padding: 8px 12px;
    border: 1px solid var(--border-color);
    background: white;
    color: #333;
    border-radius: var(--radius-sm);
    font-size: 12px;
    font-weight: 500;
    cursor: pointer;
    transition: var(--transition-fast);
    white-space: nowrap;
    min-width: 60px;
    text-align: center;
    display: inline-block;
}

.context-menu-btn:hover {
    background: var(--bg-light);
    border-color: var(--primary-color);
    color: var(--primary-color);
    transform: translateY(-1px);
}

.context-menu-btn-primary {
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    color: white !important;
    border-color: var(--primary-color);
}

.context-menu-btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(88, 86, 214, 0.3);
    color: white !important;
}

.context-menu-divider {
    height: 1px;
    background: var(--border-light);
    margin: 0;
}

/* 屏蔽 panel 区域的浏览器右键菜单 */
#viz-container,
.viz-panel,
svg {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}

/* Toast Notification */
.toast-notification {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: var(--text-primary);
    color: var(--bg-white);
    padding: 12px 24px;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    z-index: 10000;
    font-size: var(--font-md);
    font-weight: 500;
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.3s ease, transform 0.3s ease;
    pointer-events: none;
}

.toast-notification.show {
    opacity: 1;
    transform: translateY(0);
}

/* ========== Modal Styles (Centered) ========== */
.info-modal {
    display: none;
    position: fixed;
    z-index: 10000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background-color: rgba(0, 0, 0, 0.5);
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(2px);
}

.info-modal[aria-hidden="false"] {
    display: flex !important;
}

.info-modal-content {
    background: white;
    margin: auto;
    padding: 0;
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-xl);
    display: flex;
    flex-direction: column;
    max-height: 90vh;
    width: 90%;
    max-width: 1200px;
    position: relative;
    animation: fadeIn 0.3s ease;
}

.info-modal-header {
    padding: 16px 24px;
    border-bottom: 1px solid var(--border-light);
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--bg-light);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

.info-modal-header h3 {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    color: var(--text-primary);
}

.info-modal-close {
    background: none;
    border: none;
    font-size: 24px;
    line-height: 1;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: var(--transition-fast);
}

.info-modal-close:hover {
    background: rgba(0,0,0,0.1);
    color: var(--text-primary);
}

.info-modal-body {
    padding: 24px;
    overflow-y: auto;
    flex: 1;
}

.info-modal-overlay {
    position: absolute;
    inset: 0;
    z-index: -1;
}
/* Ensure modals have white background */
.info-modal-body, .info-modal-container, .info-modal-content {
    background-color: var(--bg-white, #fff);
}
#file-preview-modal .info-modal-container, 
#column-mapping-modal .info-modal-container {
    background-color: var(--bg-white, #fff);
}

/* Drag and drop styles */
.dragging {
    opacity: 0.5;
    background-color: #f0f0f0;
}


/* Collapsible Panel Header Styles */
.panel-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #f0f3f7 0%, #e8ecf1 100%);
    border-bottom: 1px solid var(--border-color);
    padding-right: var(--spacing-md);
}

.panel-header-row .panel-title {
    background: none;
    border-bottom: none;
    flex-grow: 1;
}

.panel-toggle-btn {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 12px;
    padding: 4px 8px;
    font-weight: 600;
    transition: color 0.2s;
}

.panel-toggle-btn:hover {
    color: var(--primary-color);
}

/* Mode Switcher Styles */
.mode-control-group {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-sm);
}

.mode-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 4px;
}

.mode-header label {
    font-weight: 600;
    color: var(--text-primary);
    margin-bottom: 0;
}

.mode-switcher {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 4px;
    background: var(--bg-light);
    padding: 4px;
    border-radius: var(--radius-lg);
    border: 1px solid var(--border-color);
}

.mode-btn {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 4px;
    padding: 8px 2px;
    background: transparent;
    border: 1px solid transparent;
    border-radius: var(--radius-md);
    cursor: pointer;
    color: var(--text-secondary);
    transition: var(--transition-fast);
    font-size: 10px;
    font-weight: 600;
    white-space: nowrap;
}

.mode-btn:hover {
    background: rgba(0, 0, 0, 0.03);
    color: var(--primary-color);
}

.mode-btn.active {
    background: var(--bg-white);
    color: var(--primary-color);
    border-color: var(--border-color);
    box-shadow: var(--shadow-sm);
    font-weight: 600;
}

.mode-btn svg {
    opacity: 0.7;
    transition: var(--transition-fast);
}

.mode-btn.active svg {
    opacity: 1;
    stroke: var(--primary-color);
}

